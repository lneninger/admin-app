{"ast":null,"code":"import { __awaiter, __decorate } from \"tslib\";\nimport { BankAccountComponent } from './../../../../../shared/payment/bank-account/bank-account.component';\nimport { Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { AutoUnsubscribe } from 'ngx-auto-unsubscribe';\nimport { StripeCardComponent, StripeIdealBankComponent } from 'ngx-stripe';\nimport { NavigationItemIds } from 'src/app/main/main.navigation';\nimport { ComponentDisplayMode } from 'src/app/shared/general.models';\nimport { HybridDisplayModeComponent } from 'src/app/shared/hybrid.displaymode.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared/layout/layout-main/navigation/breadcrumb/breadcrumb.service\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"src/app/shared/payment/+services/payment.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"ngx-stripe\";\nimport * as i6 from \"@angular/material/dialog\";\nimport * as i7 from \"src/app/main/services/user/auth.service\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"../../../../../shared/layout/layout-main/layout-main-common/page/page.component\";\nimport * as i10 from \"@angular/material/button\";\nimport * as i11 from \"@angular/flex-layout/flex\";\nimport * as i12 from \"@angular/material/tabs\";\nimport * as i13 from \"../../../../../shared/payment/bank-account/bank-account.component\";\n\nfunction PaymentMethodNewComponent_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"app-page\", 4);\n    i0.ɵɵelementContainer(1, 5);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n\n    const _r3 = i0.ɵɵreference(6);\n\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngTemplateOutlet\", _r3);\n  }\n}\n\nfunction PaymentMethodNewComponent_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainer(0, 5);\n  }\n\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n\n    const _r3 = i0.ɵɵreference(6);\n\n    i0.ɵɵproperty(\"ngTemplateOutlet\", _r3);\n  }\n}\n\nfunction PaymentMethodNewComponent_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"h2\", 6);\n    i0.ɵɵtext(1, \"New payment method\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"mat-dialog-content\");\n    i0.ɵɵelementContainer(3, 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"mat-dialog-actions\", 7);\n    i0.ɵɵelementStart(5, \"button\", 8);\n    i0.ɵɵtext(6, \"Cancel\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function PaymentMethodNewComponent_ng_template_4_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.save();\n    });\n    i0.ɵɵtext(8, \"Ok\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n\n    const _r3 = i0.ɵɵreference(6);\n\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngTemplateOutlet\", _r3);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"mat-dialog-close\", true)(\"disabled\", !(ctx_r2.bankAccountComponent == null ? null : ctx_r2.bankAccountComponent.selectedAccount));\n  }\n}\n\nfunction PaymentMethodNewComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"section\", 10);\n    i0.ɵɵelementStart(1, \"mat-tab-group\", 11);\n    i0.ɵɵelementStart(2, \"mat-tab\", 12);\n    i0.ɵɵelementStart(3, \"section\", 10);\n    i0.ɵɵelementStart(4, \"form\", 13);\n    i0.ɵɵlistener(\"ngSubmit\", function PaymentMethodNewComponent_ng_template_5_Template_form_ngSubmit_4_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.createToken();\n    });\n    i0.ɵɵelement(5, \"input\", 14);\n    i0.ɵɵelement(6, \"ngx-stripe-card\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"mat-tab\", 16);\n    i0.ɵɵelementStart(8, \"section\", 17);\n    i0.ɵɵelement(9, \"app-bank-account\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formGroup\", ctx_r4.stripeTest);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"options\", ctx_r4.cardOptions)(\"elementsOptions\", ctx_r4.elementsOptions);\n  }\n}\n\nfunction BankingPaymentMethodDialog_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"app-page\", 4);\n    i0.ɵɵelementContainer(1, 5);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n\n    const _r3 = i0.ɵɵreference(6);\n\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngTemplateOutlet\", _r3);\n  }\n}\n\nfunction BankingPaymentMethodDialog_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainer(0, 5);\n  }\n\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n\n    const _r3 = i0.ɵɵreference(6);\n\n    i0.ɵɵproperty(\"ngTemplateOutlet\", _r3);\n  }\n}\n\nfunction BankingPaymentMethodDialog_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"h2\", 6);\n    i0.ɵɵtext(1, \"New payment method\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"mat-dialog-content\");\n    i0.ɵɵelementContainer(3, 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"mat-dialog-actions\", 7);\n    i0.ɵɵelementStart(5, \"button\", 8);\n    i0.ɵɵtext(6, \"Cancel\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function BankingPaymentMethodDialog_ng_template_4_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.save();\n    });\n    i0.ɵɵtext(8, \"Ok\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n\n    const _r3 = i0.ɵɵreference(6);\n\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngTemplateOutlet\", _r3);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"mat-dialog-close\", true)(\"disabled\", !(ctx_r2.bankAccountComponent == null ? null : ctx_r2.bankAccountComponent.selectedAccount));\n  }\n}\n\nfunction BankingPaymentMethodDialog_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"section\", 10);\n    i0.ɵɵelementStart(1, \"mat-tab-group\", 11);\n    i0.ɵɵelementStart(2, \"mat-tab\", 12);\n    i0.ɵɵelementStart(3, \"section\", 10);\n    i0.ɵɵelementStart(4, \"form\", 13);\n    i0.ɵɵlistener(\"ngSubmit\", function BankingPaymentMethodDialog_ng_template_5_Template_form_ngSubmit_4_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.createToken();\n    });\n    i0.ɵɵelement(5, \"input\", 14);\n    i0.ɵɵelement(6, \"ngx-stripe-card\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"mat-tab\", 16);\n    i0.ɵɵelementStart(8, \"section\", 17);\n    i0.ɵɵelement(9, \"app-bank-account\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formGroup\", ctx_r4.stripeTest);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"options\", ctx_r4.cardOptions)(\"elementsOptions\", ctx_r4.elementsOptions);\n  }\n}\n\nlet PaymentMethodNewComponent = class PaymentMethodNewComponent extends HybridDisplayModeComponent {\n  constructor(breadcrumbService, fmBuilder, service, router, route, stripeService, dialog, paymentService, authService) {\n    super();\n    this.fmBuilder = fmBuilder;\n    this.service = service;\n    this.router = router;\n    this.route = route;\n    this.stripeService = stripeService;\n    this.dialog = dialog;\n    this.paymentService = paymentService;\n    this.authService = authService;\n    this.stripeTest = this.createForm();\n    this.cardOptions = {\n      style: {\n        base: {\n          iconColor: '#666EE8',\n          color: '#31325F',\n          fontWeight: '300',\n          fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n          fontSize: '18px',\n          '::placeholder': {\n            color: '#CFD7E0'\n          }\n        }\n      }\n    };\n    this.elementsOptions = {\n      locale: 'en'\n    };\n    breadcrumbService.build(NavigationItemIds.HOME, NavigationItemIds.QUOTES, NavigationItemIds.QUOTE_NEW);\n    this.displayMode = ComponentDisplayMode.Dialog;\n  }\n\n  ngOnInit() {}\n\n  ngAfterViewInit() {\n    super.ngAfterViewInit();\n    setTimeout(() => {\n      this.initialize();\n    }, 0);\n  }\n\n  initialize() {\n    if ([ComponentDisplayMode.Dialog, undefined].findIndex(dialogMode => dialogMode === this.displayMode) >= 0) {\n      const dialogRef = this.dialog.open(BankingPaymentMethodDialog, {\n        width: '450px',\n        height: '350px',\n        data: {\n          displayMode: this.displayMode\n        }\n      });\n      dialogRef.afterClosed().subscribe(result => {\n        console.log(`Dialog result: ${result}`);\n      });\n    }\n  }\n\n  createForm() {\n    return this.fmBuilder.group({\n      name: [[Validators.required]],\n      description: [],\n      activateDate: [new Date(), [Validators.required]]\n    });\n  }\n\n  onSubmit(event) {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.createToken();\n    });\n  }\n\n  save() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.bankAccountComponent) {\n        yield this.bankAccountComponent.createBankAccount(true);\n      } else {\n        this.stripeService.createToken(this.card.element);\n      }\n    });\n  }\n\n  createToken() {\n    const name = this.stripeTest.get('name').value;\n    this.stripeService.createToken(this.card.element, {\n      name\n    }).subscribe(result => __awaiter(this, void 0, void 0, function* () {\n      if (result.token) {\n        // Use the token\n        const req = {\n          userId: this.authService.credentials.user.uid,\n          source: {}\n        };\n        yield this.paymentService.createSource(req);\n        console.log(result.token.id);\n      } else if (result.error) {\n        // Error creating the token\n        console.log(result.error.message);\n      }\n    }));\n  }\n\n};\n\nPaymentMethodNewComponent.ɵfac = function PaymentMethodNewComponent_Factory(t) {\n  return new (t || PaymentMethodNewComponent)(i0.ɵɵdirectiveInject(i1.BreadcrumbService), i0.ɵɵdirectiveInject(i2.FormBuilder), i0.ɵɵdirectiveInject(i3.PaymentService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i5.StripeService), i0.ɵɵdirectiveInject(i6.MatDialog), i0.ɵɵdirectiveInject(i3.PaymentService), i0.ɵɵdirectiveInject(i7.AuthService));\n};\n\nPaymentMethodNewComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: PaymentMethodNewComponent,\n  selectors: [[\"app-payment-method-new\"]],\n  viewQuery: function PaymentMethodNewComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(StripeCardComponent, 5);\n      i0.ɵɵviewQuery(StripeIdealBankComponent, 5);\n      i0.ɵɵviewQuery(BankAccountComponent, 5);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.card = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.idealBank = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.bankAccountComponent = _t.first);\n    }\n  },\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 7,\n  vars: 4,\n  consts: [[1, \"h-max\", \"h-full\"], [3, \"ngSwitch\"], [3, \"ngSwitchCase\"], [\"htmlContent\", \"\"], [\"title\", \"New payment method\"], [3, \"ngTemplateOutlet\"], [\"mat-dialog-title\", \"\"], [\"align\", \"end\"], [\"mat-button\", \"\", \"mat-dialog-close\", \"\", \"cdkFocusInitial\", \"\"], [\"mat-button\", \"\", 3, \"mat-dialog-close\", \"disabled\", \"click\"], [\"fxFlex\", \"\", \"fxFlexFill\", \"\"], [\"fxFlexFill\", \"\", \"fxFlex\", \"\", \"fxLayout\", \"column\", \"fxLayoutAlign\", \"stretch stretch\", 1, \"custom-tab-group\", \"fill\"], [\"label\", \"Credit card\"], [\"novalidate\", \"\", 1, \"checkout\", 3, \"formGroup\", \"ngSubmit\"], [\"type\", \"text\", \"formControlName\", \"name\", \"placeholder\", \"Jane Doe\"], [3, \"options\", \"elementsOptions\"], [\"label\", \"Bank account\"], [\"fxFlex\", \"\", \"fxFlexFill\", \"\", \"fxLayoutAlign\", \"center center\"]],\n  template: function PaymentMethodNewComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelement(0, \"em\", 0);\n      i0.ɵɵelementContainerStart(1, 1);\n      i0.ɵɵtemplate(2, PaymentMethodNewComponent_ng_template_2_Template, 2, 1, \"ng-template\", 2);\n      i0.ɵɵtemplate(3, PaymentMethodNewComponent_ng_template_3_Template, 1, 1, \"ng-template\", 2);\n      i0.ɵɵtemplate(4, PaymentMethodNewComponent_ng_template_4_Template, 9, 3, \"ng-template\", 2);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵtemplate(5, PaymentMethodNewComponent_ng_template_5_Template, 10, 3, \"ng-template\", null, 3, i0.ɵɵtemplateRefExtractor);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngSwitch\", true);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngSwitchCase\", ctx.displayMode == \"Page\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngSwitchCase\", ctx.displayMode == \"Component\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngSwitchCase\", ctx.displayMode == \"Dialog\" && ctx.isDialog);\n    }\n  },\n  directives: [i8.NgSwitch, i8.NgSwitchCase, i9.PageComponent, i8.NgTemplateOutlet, i6.MatDialogTitle, i6.MatDialogContent, i6.MatDialogActions, i10.MatButton, i6.MatDialogClose, i11.DefaultFlexDirective, i11.FlexFillDirective, i12.MatTabGroup, i11.DefaultLayoutDirective, i11.DefaultLayoutAlignDirective, i12.MatTab, i2.ɵNgNoValidate, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.DefaultValueAccessor, i2.NgControlStatus, i2.FormControlName, i5.StripeCardComponent, i13.BankAccountComponent],\n  styles: [\"\"]\n});\nPaymentMethodNewComponent = __decorate([AutoUnsubscribe()], PaymentMethodNewComponent);\nexport { PaymentMethodNewComponent };\nexport let BankingPaymentMethodDialog = /*#__PURE__*/(() => {\n  class BankingPaymentMethodDialog extends PaymentMethodNewComponent {\n    constructor(data, breadcrumbService, fmBuilder, service, router, route, stripeService, dialog, paymentService, authService) {\n      super(breadcrumbService, fmBuilder, service, router, route, stripeService, dialog, paymentService, authService);\n      this.data = data;\n      this.displayMode = data.displayMode;\n      this.isDialog = true;\n    }\n\n    ngAfterViewInit() {}\n\n  }\n\n  BankingPaymentMethodDialog.ɵfac = function BankingPaymentMethodDialog_Factory(t) {\n    return new (t || BankingPaymentMethodDialog)(i0.ɵɵdirectiveInject(MAT_DIALOG_DATA), i0.ɵɵdirectiveInject(i1.BreadcrumbService), i0.ɵɵdirectiveInject(i2.FormBuilder), i0.ɵɵdirectiveInject(i3.PaymentService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i5.StripeService), i0.ɵɵdirectiveInject(i6.MatDialog), i0.ɵɵdirectiveInject(i3.PaymentService), i0.ɵɵdirectiveInject(i7.AuthService));\n  };\n\n  BankingPaymentMethodDialog.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: BankingPaymentMethodDialog,\n    selectors: [[\"app-banking-paymentmethod-dialog\"]],\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 7,\n    vars: 4,\n    consts: [[1, \"h-max\", \"h-full\"], [3, \"ngSwitch\"], [3, \"ngSwitchCase\"], [\"htmlContent\", \"\"], [\"title\", \"New payment method\"], [3, \"ngTemplateOutlet\"], [\"mat-dialog-title\", \"\"], [\"align\", \"end\"], [\"mat-button\", \"\", \"mat-dialog-close\", \"\", \"cdkFocusInitial\", \"\"], [\"mat-button\", \"\", 3, \"mat-dialog-close\", \"disabled\", \"click\"], [\"fxFlex\", \"\", \"fxFlexFill\", \"\"], [\"fxFlexFill\", \"\", \"fxFlex\", \"\", \"fxLayout\", \"column\", \"fxLayoutAlign\", \"stretch stretch\", 1, \"custom-tab-group\", \"fill\"], [\"label\", \"Credit card\"], [\"novalidate\", \"\", 1, \"checkout\", 3, \"formGroup\", \"ngSubmit\"], [\"type\", \"text\", \"formControlName\", \"name\", \"placeholder\", \"Jane Doe\"], [3, \"options\", \"elementsOptions\"], [\"label\", \"Bank account\"], [\"fxFlex\", \"\", \"fxFlexFill\", \"\", \"fxLayoutAlign\", \"center center\"]],\n    template: function BankingPaymentMethodDialog_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"em\", 0);\n        i0.ɵɵelementContainerStart(1, 1);\n        i0.ɵɵtemplate(2, BankingPaymentMethodDialog_ng_template_2_Template, 2, 1, \"ng-template\", 2);\n        i0.ɵɵtemplate(3, BankingPaymentMethodDialog_ng_template_3_Template, 1, 1, \"ng-template\", 2);\n        i0.ɵɵtemplate(4, BankingPaymentMethodDialog_ng_template_4_Template, 9, 3, \"ng-template\", 2);\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵtemplate(5, BankingPaymentMethodDialog_ng_template_5_Template, 10, 3, \"ng-template\", null, 3, i0.ɵɵtemplateRefExtractor);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngSwitch\", true);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngSwitchCase\", ctx.displayMode == \"Page\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngSwitchCase\", ctx.displayMode == \"Component\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngSwitchCase\", ctx.displayMode == \"Dialog\" && ctx.isDialog);\n      }\n    },\n    directives: [i8.NgSwitch, i8.NgSwitchCase, i9.PageComponent, i8.NgTemplateOutlet, i6.MatDialogTitle, i6.MatDialogContent, i6.MatDialogActions, i10.MatButton, i6.MatDialogClose, i11.DefaultFlexDirective, i11.FlexFillDirective, i12.MatTabGroup, i11.DefaultLayoutDirective, i11.DefaultLayoutAlignDirective, i12.MatTab, i2.ɵNgNoValidate, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.DefaultValueAccessor, i2.NgControlStatus, i2.FormControlName, i5.StripeCardComponent, i13.BankAccountComponent],\n    styles: [\"\"]\n  });\n  return BankingPaymentMethodDialog;\n})();","map":null,"metadata":{},"sourceType":"module"}